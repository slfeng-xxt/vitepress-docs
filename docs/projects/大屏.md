# å¤§å±é¡¹ç›®æ„å»º

:::tip
å¤§å±æ•°æ®å¯è§†åŒ–é¡¹ç›®

åœ°å€ï¼š<https://github.com/slfeng-xxt/large-screen>
:::

## 1. å…¬å¸é¡¹ç›®æ¨¡æ¿è„šæ‰‹æ¶å®‰è£…

ï¼ˆä»…å…¬å¸ç½‘ç»œä¸‹ä½¿ç”¨ï¼‰

```bash
npm i -g fsl-kb-cli
fsl-kb create `project-name`
```

## 2. é¡¹ç›®æ„å»º

### 2.0 åˆ›å»ºé¡¹ç›®

- [åˆ›å»ºä¸€ä¸ª Vue åº”ç”¨](https://cn.vuejs.org/guide/quick-start.html)

```bash
pnpm create vue@latest
```

### 2.1 ä¾èµ–åº“å®‰è£…

:::tip
å¤§å±è‡ªé€‚åº”é—®é¢˜ï¼š

1. autofit <https://juejin.cn/post/7224015103481118757>

2. v-scale-screen ç»„ä»¶ <https://www.cnblogs.com/0722tian/p/18247162> âœ…

:::

- [@kjgl77/datav-vue3](https://datav-vue3.netlify.app/Other/ScrollBoard/ScrollBoard.html)
- [vue-baidu-map-3x](https://map.heifa.site/doc/overlay/overlay.html#%E7%A4%BA%E4%BE%8B)
- mockjsã€vite-plugin-mock(æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚çš„ mock æ’ä»¶)

```ts
// v-scale-screenå®ç° scale
const autoScale = (scale: number) => {
  if (!props.autoScale) return;
  const domWidth = el.value!.clientWidth;
  const domHeight = el.value!.clientHeight;
  const currentWidth = document.body.clientWidth;
  const currentHeight = document.body.clientHeight;
  el.value!.style.transform = `scale(${scale},${scale})`;
  let mx = Math.max((currentWidth - domWidth * scale) / 2, 0);
  let my = Math.max((currentHeight - domHeight * scale) / 2, 0);
  if (typeof props.autoScale === "object") {
    !props.autoScale.x && (mx = 0);
    !props.autoScale.y && (my = 0);
  }
  el.value!.style.margin = `${my}px ${mx}px`;
};
```

### 2.2 å¸¸ç”¨ç»„ä»¶

- <https://hu-snail.github.io/vue3-resource/>

#### **åœ°å›¾ç»„ä»¶** ã€TODOã€‘

- [ç™¾åº¦åœ°å›¾ç¤ºä¾‹](https://lbsyun.baidu.com/jsdemo.htm#webgl2_0)
- [ç™¾åº¦åœ°å›¾ API](https://lbsyun.baidu.com/cms/jsapi/reference/jsapi_reference.html#a3b0)
- [webGlv1.0](https://mapopen-pub-jsapi.bj.bcebos.com/jsapi/reference/jsapi_webgl_1_0.html)
- ç™¾åº¦åœ°å›¾å®æ—¶ç›‘å¬ç¼©æ”¾çº§åˆ«<https://blog.csdn.net/m0_38010595/article/details/117982444>

#### **å¤©æ°”ç»„ä»¶**

æ–¹å¼ä¸€ï¼šopenweathermap (ä¸é€‰ï¼Œè¿”å›å‚æ•°ä¸å¥½)

- <https://www.wanjunshijie.com/note/vue/10750.html>

```txt
æ¥å£keyè·å–ï¼š
åœ°å€ï¼š https://home.openweathermap.org/api_keys
```

æ–¹å¼äºŒï¼šç™¾åº¦å¤©æ°”

- <https://lbs.baidu.com/faq/api?title=webapi/weather/base>
- <https://blog.csdn.net/kuang_wu/article/details/145336844>

é—®é¢˜ï¼šåŠ¨æ€å¼•å…¥å›¾ç‰‡<https://www.jianshu.com/p/466c27524c82>

#### **æ•°å­— LED æ—¶é—´ç»„ä»¶** ã€TODOã€‘

æ–¹å¼ä¸€ï¼š

<https://juejin.cn/post/6844904016695017480>

<https://fly63.com/article/detial/7359>

æ–¹å¼äºŒï¼š å¼•å…¥å­—ä½“åº“

#### **é‡‘é¢æ ¼å¼åŒ–æ˜¾ç¤ºç»„ä»¶ + æ•°å­—æ»šåŠ¨**

- å­ç»„ä»¶ï¼šDigitalDigit.vue
  <demo vue="../demos/projects/components/DigitalDigit.vue" stackblitz="true" codesandbox="true" />
- çˆ¶ç»„ä»¶ï¼šDigitalAmount.vue
  <demo vue="../demos/projects/components/DigitalAmount.vue" stackblitz="true" codesandbox="true" />
- åº”ç”¨ï¼šDigital.vue
  <demo vue="../demos/projects/Digital.vue" stackblitz="true" codesandbox="true" />

è¯¦è§ï¼š[DigitalAmount.vue](https://github.com/slfeng-xxt/large-screen/blob/main/src/components/digital/DigitalAmount.vue)

#### **vue å°è£…çš„å¯è§†åŒ–æ»šåŠ¨è¡¨æ ¼ç»„ä»¶** ã€TODOã€‘

åŸç†ï¼šå®šæ—¶å™¨ï¼ˆä¿®æ”¹å½“å‰éœ€è¦æ˜¾ç¤ºæ•°æ®çš„ç´¢å¼•ï¼‰ + è®¡ç®—å½“å‰æ˜¾ç¤ºçš„è¡Œ

è¯¦è§ï¼š[ScrollTable.vue](https://github.com/slfeng-xxt/large-screen/blob/main/src/components/table/ScrollTable.vue)

å…¶ä»–å®ç°æ–¹å¼ï¼š<https://www.jianshu.com/p/1b334c5c5c17>

#### **vue å°è£…çš„åˆ»åº¦ç»„ä»¶**

<demo vue="../demos/projects/TestScale.vue" stackblitz="true" codesandbox="true" />

åŸç†ï¼šrelative absolute å®šä½ + è®¡ç®—åˆ»åº¦ä½ç½® + å½“å‰åˆ»åº¦æ˜¾ç¤ºï¼ˆåŠ¨æ€æ ·å¼ç»‘å®šï¼‰

è¯¦è§ï¼š[ScaleIndeicator.vue](https://github.com/slfeng-xxt/large-screen/blob/dev-2/src/components/scale/ScaleIndeicator.vue)

### 2.3 hooks

1. echarts å›¾è¡¨å°è£…ï¼š [useEcharts.js](https://github.com/slfeng-xxt/large-screen/blob/dev-2/src/hooks/echarts/useEcharts.js)

2. åœ°å›¾ç›¸å…³æ“ä½œå°è£… [useInitMap.js](https://github.com/slfeng-xxt/large-screen/blob/dev-2/src/hooks/map/useInitMap.js)

### 2.4 åœ°å›¾ SDK

ç™¾åº¦åœ°å›¾ SDK å¼‚æ­¥åŠ è½½

- <https://liubing.me/article/vue/vue3-load-maps-async.html>

### 2.5 å·¥å…·ç±»

- createOverlayDom.js : åˆ›å»ºåœ°å›¾è¦†ç›–ç‰© dom, æœ‰ä¸¤ç§æ–¹å¼ï¼š 1. ç›´æ¥åˆ›å»º dom 2. å¼•å…¥ vue ç»„ä»¶ï¼Œæ„å»ºå“åº”å¼ dom

ã€**ç‰ˆæœ¬ä¸€**ï¼šå¼€å‘ç¯å¢ƒæ­£å¸¸ç‰ˆæœ¬ï¼Œä½†æ˜¯çº¿ä¸Šæœ‰é—®é¢˜ã€‚åŸå› ï¼š`_instance`åœ¨çº¿ä¸Šç‰ˆæœ¬ä¸­ä¸º undefinedã€‘

```js
// åˆ›å»ºVueç»„ä»¶å®ä¾‹
const createAppContainer = (comp, params) => {
  const container = document.createElement("div");
  // åˆ›å»ºVueåº”ç”¨å®ä¾‹
  const app = createApp({
    render() {
      return h(comp, {
        ...params,
        ref: "overlayRef",
      });
    },
  });

  // æŒ‚è½½Vueåº”ç”¨
  app.mount(container);

  // ä¿å­˜appå®ä¾‹åˆ°containerï¼Œä»¥ä¾¿åç»­æ¸…ç†
  container._vueApp = app;

  return container;
};

export const cardTypeMap = {
  [OVERLAY_ENUM.demo]: createDOM,
  [OVERLAY_ENUM.transportation]: createAppContainer.bind(
    null,
    TransportationOverlay
  ), // åˆ›å»ºè¿è¾“çŠ¶æ€è¦†ç›–ç‰©çš„DOMå…ƒç´ (ç»„ä»¶å®ä¾‹)
};
```

```js
import { ref } from "vue";

/**
 * @description æ›´æ–°è¦†ç›–ç‰©Hook
 */
export const useUpdateOverlay = () => {
  // å­˜å‚¨è¦†ç›–ç‰©å¼•ç”¨
  const overlayRefs = ref({});

  const updateOverlay = (id, updataParams) => {
    const overlay = overlayRefs.value[id];

    if (overlay && overlay._vueContainer) {
      const instance = overlay._vueContainer._vueApp._instance;
      // è·å–å®é™…çš„ç»„ä»¶å®ä¾‹
      const componentInstance = instance.refs.overlayRef;

      if (componentInstance) {
        // è°ƒç”¨ç»„ä»¶å®ä¾‹çš„updateDataæ–¹æ³•æ›´æ–°æ•°æ®
        componentInstance.updateData(updataParams); // defineExpose æš´éœ²çš„æ–¹æ³•
      } else {
        console.log("No exposed methods found on component");
      }
    }
  };

  return {
    overlayRefs,
    updateOverlay,
  };
};
```

ã€**ç‰ˆæœ¬äºŒ**ï¼šä¿®æ”¹åç‰ˆæœ¬ã€‘

```js
// createOverlayDom.js
import { OVERLAY_ENUM } from "@/utils/enum";
import TransportationOverlay from "@/components/overlay/TransportationOverlay.vue";
// åˆ›å»ºVueç»„ä»¶å®ä¾‹
const createAppContainer = (comp, params) => {
  try {
    const container = document.createElement("div");

    // åˆ›å»ºVueåº”ç”¨å®ä¾‹
    const app = createApp({
      setup() {
        const instance = getCurrentInstance(); // è·å–å½“å‰å®ä¾‹
        return { instance };
      },
      render() {
        return h(comp, {
          ...params,
          ref: "overlayRef",
        });
      },
    });

    // æŒ‚è½½Vueåº”ç”¨
    const root = app.mount(container);

    // ä¿å­˜appå®ä¾‹åˆ°containerï¼Œä»¥ä¾¿åç»­æ¸…ç†
    container._vueApp = {
      app,
      instance_qt: root.instance,
    };

    return container;
  } catch (error) {
    console.error("createAppContainer error:", error);
    return document.createElement("div"); // è¿”å›ç©ºå®¹å™¨å…œåº•
  }
};

// createAppContainer.bind(null, TransportationOverlay) çš„ç›®çš„ï¼šå°†TransportationOverlayç»„ä»¶ä½œä¸ºå‚æ•°ä¼ é€’ç»™createAppContainerå‡½æ•°
export const cardTypeMap = {
  [OVERLAY_ENUM.transportation]: createAppContainer.bind(
    null,
    TransportationOverlay
  ), // åˆ›å»ºè¿è¾“çŠ¶æ€è¦†ç›–ç‰©çš„DOMå…ƒç´ (ç»„ä»¶å®ä¾‹)\
};

// æ¸…ç†Vueåº”ç”¨å®ä¾‹
export const cleanupOverlay = (container) => {
  if (!container) return;
  // 1. å…ˆå¸è½½Vueåº”ç”¨
  if (container._vueApp && container._vueApp?.app) {
    // console.log(container._vueApp.app, '=========æ¸…ç†Vueåº”ç”¨å®ä¾‹=========')
    container._vueApp.app.unmount();
    delete container._vueApp;
    container = null; // æ¸…ç†å®¹å™¨å¼•ç”¨
  }
};
```

```js
// useUpdateOverlay.js
/**
 * @description æ›´æ–°è¦†ç›–ç‰©Hook
 */
export const useUpdateOverlay = () => {
  // å­˜å‚¨è¦†ç›–ç‰©å¼•ç”¨
  const overlayRefs = ref({});

  const updateOverlay = (id, updataParams) => {
    const overlay = overlayRefs.value[id];

    if (overlay && overlay._vueContainer) {
      const { instance_qt: instance } = overlay._vueContainer._vueApp;
      // bug: ç”Ÿäº§æœ‰é—®é¢˜ï¼šVue 3 åœ¨ç”Ÿäº§æ„å»ºæ—¶ä¼šç§»é™¤å¼€å‘ä¸“ç”¨çš„å±æ€§ï¼ˆå¦‚ _instanceï¼‰é¿å…ç›´æ¥ä¾èµ–å†…éƒ¨å±æ€§ï¼Œä½¿ç”¨getCurrentInstanceè·å–å½“å‰å®ä¾‹
      // const instance = overlay._vueContainer._vueApp._instance
      // console.log('ğŸš€ ~ updateOverlay ~ instance:', instance)
      // è·å–å®é™…çš„ç»„ä»¶å®ä¾‹
      const componentInstance = instance.refs.overlayRef;

      if (componentInstance) {
        componentInstance.updateData(updataParams);
      } else {
        console.log("No exposed methods found on component");
      }
    }
  };

  return {
    overlayRefs,
    updateOverlay,
  };
};
```

## 3. é…ç½®

### 3.1 vite.config.js

#### plugin

- [vite-plugin-zip-pack]
- [vite-plugin-mock] ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼š<https://www.itcan.cn/2024/01/23/vite-plugin-mock3/>
- [AutoImportVitePlugin]
- [cssåå¤„ç†å™¨ï¼šautoprefixer](https://blog.csdn.net/qq_44919431/article/details/145797657)ã€**TODO**: å¾…æ·»åŠ ã€‘

vite-plugin-mock ç›¸å…³é¡¹ç›®ï¼š

- <https://gitcode.com/gh_mirrors/jh/jh-vue3-admin/tree/main>
- <https://github.com/vbenjs/vite-plugin-mock/blob/ca2e9eabf1704f2e1bbb33f4cd66bfd440c90828/packages/vite-plugin-mock/src/client.ts>

#### server

ç™¾åº¦å¤©æ°”è¯·æ±‚åšä»£ç†

```js
 server: {
    proxy: {
    // è·¨åŸŸä»£ç†ç™¾åº¦å¤©æ°”API
    '/baiduApi': {
        target: 'https://api.map.baidu.com', // æ›¿æ¢ä¸ºç›®æ ‡APIçš„URL
        changeOrigin: true, // æ›´æ”¹è¯·æ±‚æºå¤´ä¿¡æ¯
        rewrite: (path) => path.replace(/^\/baiduApi/, ''), // é‡å†™è·¯å¾„
        secure: true, // å¦‚æœæ˜¯HTTPSç›®æ ‡ï¼Œåˆ™è®¾ç½®ä¸ºtrue
    },
    },
},
```

### 3.2 package.json

#### 3.2.1 å›¢é˜Ÿåä½œè§„èŒƒé…ç½®

**å‚è€ƒ**ï¼š[å‰ç«¯å·¥ç¨‹åŒ–/pnpmmonorepoå·¥ç¨‹ç®¡ç†](/course/å‰ç«¯å·¥ç¨‹åŒ–/pnpmmonorepoå·¥ç¨‹ç®¡ç†.html#_5-ä»£ç é£æ ¼å’Œè´¨é‡æ£€æŸ¥)

- eslint
- prettier format
- hushky
- commitlint

### 3.3 å…¶ä»–é…ç½®

#### CSS è‡ªå®šä¹‰å­—ä½“@font-faceï¼šä½¿ç”¨æ–¹æ³•åŠ format å±æ€§

- <https://blog.csdn.net/Piconjo/article/details/104720807>

## 4. å…¶ä»–ï¼ˆåç»­å¯èƒ½ app å¼€å‘ï¼‰

uni-app å’Œ taro æ¨èç”¨åœ¨è·¨ç«¯å°ç¨‹åºä¸­ã€‚

è·¨å¹³å°çš„ app ä¸å»ºè®®ä½¿ç”¨ï¼Œå¦‚æœåªæ˜¯ç®€å•çš„ ui å±‚ app æˆ–è€…éœ€è¦å¿«é€Ÿé€‚é…ä¸è€ƒè™‘åŠŸèƒ½ç»†èŠ‚çš„æ·±åº¦ä¼˜åŒ–ï¼Œä¹Ÿå¯ä»¥è¯•è¯•ã€‚

è·¨å¹³å° app çš„è¯ï¼Œå¯ä»¥è€ƒè™‘ react native(äº§å“æˆç†Ÿåº¦é«˜),å’Œ flutter(çƒ­åº¦é«˜ï¼Œui å’Œæ€§èƒ½æ¥è¿‘åŸç”Ÿ)

:::tip
å½“ä½ çœ‹è§æ²³ï¼Œä½ å·²åœ¨æ²³ä¹‹å¤–ï¼›å½“ä½ çœ‹è§å±±ï¼Œä½ å·²åœ¨å±±ä¹‹å¤–ã€‚å½“ä½ èƒ½çœ‹åˆ°è‡ªå·±ä»»ä½•æƒ…ç»ªï¼Œä½ å·²åœ¨æƒ…ç»ªä¹‹å¤–ã€‚çœŸæ­£çš„å¼ºå¤§ä¸æ˜¯å¯¹æŠ—ï¼Œè€Œæ˜¯æ°¸è®¸å‘ç”Ÿã€‚ä½ æ¥çº³ä»€ä¹ˆï¼Œä»€ä¹ˆå°±ä¼šæ¶ˆå¤±ã€‚ä½ å¯¹æŠ—ä»€ä¹ˆï¼Œä»€ä¹ˆå°±ä¼šå­˜åœ¨ã€‚
:::
