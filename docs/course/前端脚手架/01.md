# 快速构建一个脚手架

## 一、目录结构

```js
 - vue-test
 |- fsl-test
        |- bin
            |- index.js
        |- package.json
 |- fsl-test-lib
        |- bin
            |- index.js
        |- package.json
```

## 二、简单流程

* **mkdir fsl-test**
* **cd fsl-test/**
* **npm init -y**
* 编辑器打开，创建bin/index.js目录

```js
// index.js (可执行文件)
#!/user/bin/env node
console.log('test...')
```

```json
// package.json 中配置bin
// ...
"bin": {
    "fsl-test": "bin/index.js"
},
```

* 将脚手架发布到npm
* npm logoin (登录)
* npm publish (发布)

## 三、测试发布到npm上的包

* **npm i -g fsl-test**   (安装到本地)
* **fsl-test**  (测试功能)
* **which fsl-test** (查看执行命令所在的路径)

### 问题

* 出现的问题：fsl-test软链接到本地代码 （方便本地调试）
* 解决上述问题：离开当前目录再重新安装**npm i -g fsl-test**
  
## 四、本地开发调试

### 本质：*(将命令与本地代码进行软链接)*

### 调试方式如下

* **软链方式一：** 在vue-test目录下执行 **npm i -g fsl-test** ，将命令软链到本地代码进行调试
* **软链方式二：** 在fsl-test目录下执行 **npm link**， 将本地代码软链到fsl-test命令下
* 移除脚手架 **npm remove -g fsl-test**

## 五、分包情况

```js
// fsl-test-lib/lib/index.js
module.exports = {
    add(a, b) {
        return a + b
    }
}
```

### fsl-test中引入fsl-test-lib

1. fsl-test-lib发布到npm的情况下，在fsl-test目录下执行**npm link fsl-test-lib**
1.1 遇到的问题：安装失败。。。
1.2 解决：先**npm link fsl-test-lib**，再**npm unlink fsl-test-lib**,全局执行**npm remove -g fsl-test-lib**, 最后执行**npm i**
2. 没发布的情况：
2.1 在fsl-test-lib目录下执行**npm link fsl-test**
2.2 手动在fsl-test/package.json中添加dependence

```js
// package.json 中配置bin
...
"bin": {
    "fsl-test": "bin/index.js"
},
"dependence": {
    "fsl-test-lib": "^1.0.0"
}
```

2.3 在fsl-test中使用fsl-test-lib

```js
// index.js (可执行文件)
#!/user/bin/env node
const lib = require('fsl-test-lib')
console.log('test...lib', lib)
```

## 六、脚手架本地link标准流程

### 链接本地脚手架

```js
cd your-cli-dir
npm link
```

### 链接本地库文件

```js
cd your-lib-dir
npm link
cd your-cli-dir
npm link your-lib
```

### 取消链接本地库文件

```js
cd your-lib-dir
npm unlink
cd your-cli-dir
// link存在
npm unlink your-lib
// link不存在
rm -rf node_modules
npm install
```

### 理解npm link

* npm link your-lib: 将当前项目中node_modules下指定的库文件链接到node全局node_modules下的库文件
* npm link: 将当前项目链接到node全局node_modules中作为一个库文件，并解析bin配置创建可执行文件

### 理解npm unlink

* npm unlink: 将当前项目从node全局node_modules中移除
* npm unlink your-lib:将当前项目中的库文件依赖移除
