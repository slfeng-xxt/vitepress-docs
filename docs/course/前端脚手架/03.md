# 脚手架实现原理

## 1. 脚手架是什么

### 为什么全局安装了@vue/cli后会添加命令vue?

1. 首先npm install -g @vue/cli,将该包安装到node的node_modules下
2. 然后which vue查看vue执行目录：node/bin/vue(这是个软连接，实际指向node/lib/node_modules/@vue/cli/bin/vue.js)
3. 在node/lib/node_modules/@vue/cli这个目录下有一个package.json，在其中有个配置项

```js
// 这里配置的vue就是添加的vue命令
"bin":{
    "vue": "bin/vue.js" 
 }
```

### 全局安装@vue/cli时，发生了什么？

0. 做两件事：下载到node_modules中，配置软链接
1. 将@vue/cli这个包安装在node/lib/node_modules下
2. 解析node/lib/node_modules/@vue/cli这个目录下有一个package.json,如果发现bin项目有配置,例如vue，就会到node/bin目录下创建软链接，而这个软链接指向../lib/node_modules/@vue/cli/bin/vue.js

### 执行vue命令时发生了什么？为什么vue指向一个js文件，我们却可以直接通过vue命令执行它？

1. 通过vue命令找到要执行的文件vue.js(which vue查看执行目录，软连到具体文件)
2. 前提：普通js文件只能通过node这样的js解释器来执行，不能在终端命令执行某个js文件
3. 对vue.js文件特殊处理：（第一行添加一行命令,获取当前系统环境变量中的node命令，并执行node,之后就可以解析执行该文件中的js代码了）

```js
// vue.js
#!/user/bin/env node
```

## 2.脚手架原理进阶

### 为什么说脚手架的本质是操作系统的客户端？它和我们PC上安装的应用和软件有什么区别？

node本身是客户端
没区别

### 如何为node脚手架命令创建别名

软链接方式：

```js
// node/bin 目录下执行以下命令
ln -s ./vue vue2
```

### 描述脚手架命令执行的全过程

- 1.输入命令： vue create vue-app
- 2.在环境变量$PATH中查询vue命令（相当于执行which vue）
- 3.查找结果
    3.1 查到了实际的链接文件，通过当前系统中的node(#!/usr/bin/env node)来执行文件
    3.2 未找到，提示没有添加该命令

## 3.脚手架核心价值

- 自动化 项目重复代码拷贝、git操作、发布上线
- 标准化 项目创建、git flow、发布流程、回滚流程
- 数据化 研发过程系统化、数据化

## 4.和自动化构建工具的区别

问：jenkins/travis等自动化构建工具都比较成熟了，为什么还需要自研脚手架？

- 不满足需求：jenkins/travis通常在git hooks中触发，需要在服务端执行，无法覆盖研发人员本地的功能，例如：创建项目自动化、本地git操作自动化
- 定制复杂：jenkins/travis定制过程需要开发插件，其过程复杂，需要使用java语言，对前端不友好
