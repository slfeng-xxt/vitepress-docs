# 中级篇

:::tip
从0️⃣到①实现一个组件库基础框架
:::

## 1. 技术选型和方案

1. 包管理工具：pnpm workspace -> 实现多包管理，提升安装速度并减少磁盘空间占用
2. 组件库开发语言： TypeScript -> 提升代码可维护性和可读性，提供类型安全，增强代码健壮性，支持类型检查
3. 文档与组件展示： dumi -> 基于React的文档工具，支持Markdown，支持组件展示，支持主题定制
4. 构建工具： typescript编译器/rollup/esbuild -> tsc进行代码编译，生成es模块和commonjs模块保证兼容性
5. 样式管理： css in js -> 通过styled-components实现样式管理，保证样式作用域隔离，支持动态样式
6. 组件组织： 模块化与分层设计 -> 按模块化组织，基础组件和复合组件分离，确保复用性和解耦性
7. 测试框架： Jest + Testing Library(扩展) -> 提供单元测试和集成测试，确保组件质量和稳定性
8. 版本控制与CI/CD： Github Actions -> 自动化构建、测试和发布，确保代码质量和版本稳定性
9. 构建产物发布： npm -> 通过npm publish发布组件库，方便用户安装和使用

优化：

1. 构建： esbuild
2. 整体架构： pnpm workspace
3. 构建环节： nx，构建缓存和增量构建
4. CI/CD 流水线编排
5. 文档发布：docker-compose 服务编排部署

## 2. 组件库文档开发

1. 创建dumi项目
2. 配置路由
3. 配置主题
4. 编写组件文档
5. 预览和发布文档

```bash
pnpm add dumi
```

## 3. 组件样式体系设计

themes -> 样式主题，支持定制和扩展

1. 创建样式主题
2. 配置主题变量
3. 编写样式组件
4. 使用样式组件

```css
:root {

  --color-red-0: #fffafa;
  --color-red-1: #ffe4e4;
  --color-red-2: #ffcaca;
  --color-red-3: #ff9999;
  --color-red-4: #ff6666;
  --color-red-5: #ff3333;
  --color-red-6: #ff0000;
  --color-red-7: #b30000;
  --color-red-8: #7f0000;
  --color-red-9: #4d0000;

  --color-green-0: #f0fff0;
  --color-green-1: #e0ffe0;
  --color-green-2: #d0ffd0;
  --color-green-3: #c0ffc0;
  --color-green-4: #b0ffb0;
  --color-green-5: #a0ffa0;
  --color-green-6: #90ff90;
  --color-green-7: #80ff80;
  --color-green-8: #70ff70;
  --color-green-9: #60ff60;

  --radius-sm: 4px;
  --radius-md: 8px;
  --radius-lg: 16px;
  --radius-xl: 32px;


  --primary-color: var(--color-red-3);
}
```

```tsx
import * as React from "react";
import styled from "styled-components";
import '../../theme/style.css'

const StyledButton = styled.button`
  color: var(--text-color);
  background-color: var(--primary-color);
  `
export const Button = ({ children= 'button' }: { children: React.ReactNode }) => {
  return <StyledButton>{children}</StyledButton>;
};

export default Button;
```

## 4. 组件的数据协议设计

1. 定义组件的属性
2. 定义组件的事件

```ts
/**
 * Button type
 */
export type ButtonType = 'primary' | 'default' | 'dashed' | 'text' | 'link';

export type ButtonSize = 'large' | 'middle' | 'small';
```

```tsx
import * as React from "react";
import styled from "styled-components";
import '../../theme/style.css'
import {ButtonType, ButtonSize} from '../../types/button'

// 组件的属性设置，组件的事件设置 ==》 组件的数据协议设计
interface ButtonProps {
  type?: ButtonType;
  size?: ButtonSize;
}

//  2. 组件的样式设计,根据变体类型，求解不同组件的UI表现 ==》 组件的UI设计
const useButtonStyle = (props: ButtonProps) => {
  const { type, size } = props;
  return `
    color: var(--text-color);
    background-color: var(--${type}-color);
    border-radius: var(--radius-${size});
    font-size: var(--font-size-${size});
  `
}

// 3. 组件的UI实现 ==》 组件的UI实现
const StyledButton = styled.button<ButtonProps>`
  ${props => useButtonStyle(props)}
  `

export const Button = (props: ButtonProps)  => {
  const { type = 'primary', size = 'md',children='Button' } = props;
  return <StyledButton {...props}>{children}</StyledButton>
};

export default Button;

```

## 5. 参考code

- <https://github.com/mantinedev/mantine/blob/master/packages/%40mantine/core/src/components/Button/Button.tsx>

## 6. 具体实现步骤

1. 初始化工程
2. 依赖选择
3. ts的配置，构建配置
4. monorepo 分包
5. 组件库文档的编写
6. 组件库构建发布： npm build npm publish
7. 组件文档发布：docker nginx 静态资源托管处理
8. 版本管理
